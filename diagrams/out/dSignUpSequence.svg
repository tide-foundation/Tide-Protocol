<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1556px" preserveAspectRatio="none" style="width:1200px;height:1556px;" version="1.1" viewBox="0 0 1200 1556" width="1200px" zoomAndPan="magnify"><defs><filter height="300%" id="fcgcknbi3a5ch" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="74" x="563" y="26.708">dSignUp</text><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="113.6641" style="stroke: #383838; stroke-width: 1.0;" width="10" x="623" y="1092.8281"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="623" y="1235.625"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="623" y="1410.4219"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="113.6641" style="stroke: #383838; stroke-width: 1.0;" width="10" x="698" y="663.3047"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="698" y="1293.8906"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="698" y="1381.2891"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1043" y="307.1797"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="226.1953" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1043" y="579.9063"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="83.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1043" y="980.2969"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="145.6641" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1043" y="1352.1563"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="188.7969" style="stroke: #000000; stroke-width: 2.0;" width="1018" x="73" y="90.25"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="234" x2="234" y1="73.25" y2="1515.8203"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="628" x2="628" y1="73.25" y2="1515.8203"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="703" x2="703" y1="73.25" y2="1515.8203"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1048" x2="1048" y1="73.25" y2="1515.8203"/><rect fill="#F8F8F8" filter="url(#fcgcknbi3a5ch)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="86" x="189" y="37.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="196" y="57.9482">Consumer</text><rect fill="#F8F8F8" filter="url(#fcgcknbi3a5ch)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="86" x="189" y="1514.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="196" y="1534.8154">Consumer</text><rect fill="#F8F8F8" filter="url(#fcgcknbi3a5ch)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="64" x="594" y="37.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="601" y="57.9482">mORKx</text><rect fill="#F8F8F8" filter="url(#fcgcknbi3a5ch)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="64" x="594" y="1514.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="601" y="1534.8154">mORKx</text><rect fill="#F8F8F8" filter="url(#fcgcknbi3a5ch)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="58" x="672" y="37.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="679" y="57.9482">vORKx</text><rect fill="#F8F8F8" filter="url(#fcgcknbi3a5ch)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="58" x="672" y="1514.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="679" y="1534.8154">vORKx</text><rect fill="#F8F8F8" filter="url(#fcgcknbi3a5ch)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="64" x="1014" y="37.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="1021" y="57.9482">Vendor</text><rect fill="#F8F8F8" filter="url(#fcgcknbi3a5ch)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="64" x="1014" y="1514.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="1021" y="1534.8154">Vendor</text><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="113.6641" style="stroke: #383838; stroke-width: 1.0;" width="10" x="623" y="1092.8281"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="623" y="1235.625"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="623" y="1410.4219"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="113.6641" style="stroke: #383838; stroke-width: 1.0;" width="10" x="698" y="663.3047"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="698" y="1293.8906"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="698" y="1381.2891"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1043" y="307.1797"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="226.1953" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1043" y="579.9063"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="83.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1043" y="980.2969"/><rect fill="#FFFFFF" filter="url(#fcgcknbi3a5ch)" height="145.6641" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1043" y="1352.1563"/><path d="M73,90.25 L143,90.25 L143,97.25 L133,107.25 L73,107.25 L73,90.25 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="188.7969" style="stroke: #000000; stroke-width: 2.0;" width="1018" x="73" y="90.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="88" y="103.3169">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="158" y="102.4604">[Precondition]</text><path d="M83,112.3828 L83,152.3828 L381,152.3828 L381,122.3828 L371,112.3828 L83,112.3828 " fill="#ECECEC" filter="url(#fcgcknbi3a5ch)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M371,112.3828 L371,122.3828 L381,122.3828 L371,112.3828 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="89" y="129.4497">username = Consumer username</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="89" y="144.5825">password [private] = Consumer's password</text><path d="M548,166.6484 L548,191.6484 L703,191.6484 L703,176.6484 L693,166.6484 L548,166.6484 " fill="#ECECEC" filter="url(#fcgcknbi3a5ch)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M693,166.6484 L693,176.6484 L703,176.6484 L693,166.6484 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="554" y="183.7153">orkId, skORKi, pkORKi</text><path d="M622,205.7813 L622,230.7813 L779,230.7813 L779,215.7813 L769,205.7813 L622,205.7813 " fill="#ECECEC" filter="url(#fcgcknbi3a5ch)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M769,205.7813 L769,215.7813 L779,215.7813 L769,205.7813 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="628" y="222.8481">orkID, skORKi, pkORKi</text><path d="M1015,244.9141 L1015,269.9141 L1077,269.9141 L1077,254.9141 L1067,244.9141 L1015,244.9141 " fill="#ECECEC" filter="url(#fcgcknbi3a5ch)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1067,244.9141 L1067,254.9141 L1077,254.9141 L1067,244.9141 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="1021" y="261.981">pkCVK</text><polygon fill="#383838" points="1031,303.1797,1041,307.1797,1031,311.1797,1035,307.1797" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="234" x2="1037" y1="307.1797" y2="307.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="241" y="302.1138">SignUpRequest()</text><polygon fill="#383838" points="245,332.3125,235,336.3125,245,340.3125,241,336.3125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="239" x2="1047" y1="336.3125" y2="336.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="251" y="331.2466">pkVen, List(Orks)</text><path d="M107,349.3125 L107,404.3125 L357,404.3125 L357,359.3125 L347,349.3125 L107,349.3125 " fill="#ECECEC" filter="url(#fcgcknbi3a5ch)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M347,349.3125 L347,359.3125 L357,359.3125 L347,349.3125 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="113" y="366.3794">userId = hash(username)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="113" y="381.5122">gPass = point(hash(password)) ∈ G</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="113" y="396.645">CMK = point(random1) ∈ G</text><path d="M63,418.7109 L63,549.7109 L400,549.7109 L400,428.7109 L390,418.7109 L63,418.7109 " fill="#ECECEC" filter="url(#fcgcknbi3a5ch)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M390,418.7109 L390,428.7109 L400,428.7109 L390,418.7109 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="69" y="435.7778">VUID = hash(pkVen * skCMK)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="69" y="450.9106">cvkAuth = pkVen * skCMK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="69" y="466.0435">CVK = point(random2) ∈ G</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="69" y="481.1763">vORKi = List(vORK)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="69" y="496.3091">CVKi = share(skCVK, vORKiId)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="69" y="511.4419">CVKAuthi = hmac(pkVORKi, cvkAuth)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="69" y="526.5747">vPacki = ECEnc((VUID; CVKAuthi; CVKi), pkVORKi)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="69" y="541.7075">vPackSigni = hmac(vPacki, CVKAuthi)</text><polygon fill="#383838" points="1031,575.9063,1041,579.9063,1031,583.9063,1035,579.9063" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="234" x2="1037" y1="579.9063" y2="579.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="291" x="241" y="574.8403">SetupKey( VUID , vORKi , vPacki , vPackSigni )</text><path d="M920,592.9063 L920,632.9063 L1172,632.9063 L1172,602.9063 L1162,592.9063 L920,592.9063 " fill="#ECECEC" filter="url(#fcgcknbi3a5ch)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1162,592.9063 L1162,602.9063 L1172,602.9063 L1162,592.9063 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="926" y="609.9731">Validate vORKi</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="926" y="625.106">vPackAuthi = ECSign(vPacki, skVen)</text><polygon fill="#383838" points="719,659.3047,709,663.3047,719,667.3047,715,663.3047" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="713" x2="1042" y1="663.3047" y2="663.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="725" y="658.2388">AddKey( vPacki , vPackSigni , vPackAuthi , pkVen)</text><path d="M559,676.3047 L559,746.3047 L842,746.3047 L842,686.3047 L832,676.3047 L559,676.3047 " fill="#ECECEC" filter="url(#fcgcknbi3a5ch)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M832,676.3047 L832,686.3047 L842,686.3047 L832,676.3047 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="565" y="693.3716">ECValidSign(vPacki,pkVen) ?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="565" y="708.5044">VUID; CVKAuthi; CVKi = ECDec(vPacki)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="565" y="723.6372">hmac(vPacki, CVKAuthi) == vPackSigni ?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="565" y="738.77">Store(VUID; CVKAuthi; CVKi)</text><polygon fill="#383838" points="1031,772.9688,1041,776.9688,1031,780.9688,1035,776.9688" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="703" x2="1037" y1="776.9688" y2="776.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="710" y="771.9028">Conf</text><polygon fill="#383838" points="245,802.1016,235,806.1016,245,810.1016,241,806.1016" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="239" x2="1047" y1="806.1016" y2="806.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="251" y="801.0356">Conf</text><path d="M8,819.1016 L8,950.1016 L456,950.1016 L456,829.1016 L446,819.1016 L8,819.1016 " fill="#ECECEC" filter="url(#fcgcknbi3a5ch)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M446,819.1016 L446,829.1016 L456,829.1016 L446,819.1016 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="14" y="836.1685">AuthPRISM = hash(random3)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="14" y="851.3013">AuthProof = hash(gPass * AuthPRISM)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="14" y="866.4341">mORKi = List(mORK)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="14" y="881.5669">CMKi = share(skCMK, mOrkId)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="14" y="896.6997">AuthPRISMi = share(AuthPRISM, mORKiId)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="14" y="911.8325">CMKAuthi = hmac(pkMORKi, AuthProof)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="427" x="14" y="926.9653">mPacki = ECEnc((userId ; AuthPRISMi ; CMKAuthi ; CMKi), pkMORKi)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="14" y="942.0981">mPackSigni = hmac(vPacki, CMKAuthi)</text><polygon fill="#383838" points="1031,976.2969,1041,980.2969,1031,984.2969,1035,980.2969" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="234" x2="1037" y1="980.2969" y2="980.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="241" y="975.231">SetupAuth( VUID , mPacki )</text><path d="M903,993.2969 L903,1033.2969 L1188,1033.2969 L1188,1003.2969 L1178,993.2969 L903,993.2969 " fill="#ECECEC" filter="url(#fcgcknbi3a5ch)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1178,993.2969 L1178,1003.2969 L1188,1003.2969 L1178,993.2969 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="909" y="1010.3638">Validate mPacki (just count)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="909" y="1025.4966">mPackAuthi = hmac(mPacki, mVoucheri)</text><polygon fill="#383838" points="245,1059.6953,235,1063.6953,245,1067.6953,241,1063.6953" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="239" x2="1047" y1="1063.6953" y2="1063.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="251" y="1058.6294">mPackAuthi, mVoucheri</text><polygon fill="#383838" points="611,1088.8281,621,1092.8281,611,1096.8281,615,1092.8281" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="234" x2="617" y1="1092.8281" y2="1092.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="241" y="1087.7622">AddAuth( mPacki , mPackSigni , mPackAuthi , mVoucheri)</text><path d="M437,1105.8281 L437,1175.8281 L814,1175.8281 L814,1115.8281 L804,1105.8281 L437,1105.8281 " fill="#ECECEC" filter="url(#fcgcknbi3a5ch)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M804,1105.8281 L804,1115.8281 L814,1115.8281 L804,1105.8281 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="443" y="1122.895">hmac(mPacki,mVoucheri) == mPackAuthi ?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="356" x="443" y="1138.0278">userId ; AuthPRISMi ; CMKAuthi ; CMKi = ECDec(mPacki)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="276" x="443" y="1153.1606">hmac(mPacki, CMKAuthi) == mPackSigni ?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="284" x="443" y="1168.2935">Store(userId ; AuthPRISMi ; CMKAuthi ; CMKi)</text><polygon fill="#383838" points="245,1202.4922,235,1206.4922,245,1210.4922,241,1206.4922" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="239" x2="627" y1="1206.4922" y2="1206.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="251" y="1201.4263">conf</text><polygon fill="#383838" points="611,1231.625,621,1235.625,611,1239.625,615,1235.625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="234" x2="617" y1="1235.625" y2="1235.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="241" y="1230.5591">TestRun</text><polygon fill="#383838" points="245,1260.7578,235,1264.7578,245,1268.7578,241,1264.7578" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="239" x2="627" y1="1264.7578" y2="1264.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="251" y="1259.6919">TestReply</text><polygon fill="#383838" points="686,1289.8906,696,1293.8906,686,1297.8906,690,1293.8906" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="234" x2="692" y1="1293.8906" y2="1293.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="241" y="1288.8247">TestRun</text><polygon fill="#383838" points="245,1319.0234,235,1323.0234,245,1327.0234,241,1323.0234" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="239" x2="702" y1="1323.0234" y2="1323.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="251" y="1317.9575">TestReply</text><polygon fill="#383838" points="1031,1348.1563,1041,1352.1563,1031,1356.1563,1035,1352.1563" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="234" x2="1037" y1="1352.1563" y2="1352.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="241" y="1347.0903">Commit</text><polygon fill="#383838" points="719,1377.2891,709,1381.2891,719,1385.2891,715,1381.2891" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="713" x2="1042" y1="1381.2891" y2="1381.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="725" y="1376.2231">Commit</text><polygon fill="#383838" points="611,1406.4219,621,1410.4219,611,1414.4219,615,1410.4219" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="234" x2="617" y1="1410.4219" y2="1410.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="241" y="1405.356">Commit</text><polygon fill="#383838" points="245,1435.5547,235,1439.5547,245,1443.5547,241,1439.5547" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="239" x2="627" y1="1439.5547" y2="1439.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="251" y="1434.4888">Ack</text><polygon fill="#383838" points="1031,1464.6875,1041,1468.6875,1031,1472.6875,1035,1468.6875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="703" x2="1037" y1="1468.6875" y2="1468.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="710" y="1463.6216">Ack</text><polygon fill="#383838" points="245,1493.8203,235,1497.8203,245,1501.8203,241,1497.8203" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="239" x2="1047" y1="1497.8203" y2="1497.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="251" y="1492.7544">Ack</text><!--MD5=[3e77779198a5aac8f2d0ea917c6b9719]
@startuml dSignUpSequence
skinparam monochrome true

title dSignUp
opt Precondition
note over Consumer
    username = Consumer username
    password [private] = Consumer's password
end note
note over mORKx
    orkId, skORKi, pkORKi
end note
note over vORKx
    orkID, skORKi, pkORKi
end note
note over Vendor
    pkCVK
end note
end

Consumer->Vendor: SignUpRequest()
activate Vendor

Vendor- ->Consumer: pkVen, List(Orks)
deactivate Vendor

note over Consumer
    userId = hash(username)
    gPass = point(hash(password)) ∈ G
    CMK = point(random1) ∈ G
end note

note over Consumer
    VUID = hash(pkVen * skCMK)
    cvkAuth = pkVen * skCMK
    CVK = point(random2) ∈ G
    vORKi = List(vORK)
    CVKi = share(skCVK, vORKiId)
    CVKAuthi = hmac(pkVORKi, cvkAuth)
    vPacki = ECEnc((VUID; CVKAuthi; CVKi), pkVORKi)
    vPackSigni = hmac(vPacki, CVKAuthi)
end note

Consumer->Vendor: SetupKey( VUID , vORKi , vPacki , vPackSigni )
activate Vendor

note over Vendor
    Validate vORKi
    vPackAuthi = ECSign(vPacki, skVen)
end note 
Vendor->vORKx: AddKey( vPacki , vPackSigni , vPackAuthi , pkVen)
activate vORKx

note over vORKx
    ECValidSign(vPacki,pkVen) ?
    VUID; CVKAuthi; CVKi = ECDec(vPacki)
    hmac(vPacki, CVKAuthi) == vPackSigni ?
    Store(VUID; CVKAuthi; CVKi)
end note

vORKx- ->Vendor: Conf
deactivate vORKx

Vendor- ->Consumer: Conf
deactivate Vendor
note over Consumer
    AuthPRISM = hash(random3)
    AuthProof = hash(gPass * AuthPRISM)
    mORKi = List(mORK)
    CMKi = share(skCMK, mOrkId)
    AuthPRISMi = share(AuthPRISM, mORKiId)
    CMKAuthi = hmac(pkMORKi, AuthProof)
    mPacki = ECEnc((userId ; AuthPRISMi ; CMKAuthi ; CMKi), pkMORKi)
    mPackSigni = hmac(vPacki, CMKAuthi)
end note
Consumer->Vendor: SetupAuth( VUID , mPacki )
activate Vendor

note over Vendor
    Validate mPacki (just count)
    mPackAuthi = hmac(mPacki, mVoucheri)
end note 
Vendor- ->Consumer: mPackAuthi, mVoucheri
deactivate Vendor
Consumer->mORKx: AddAuth( mPacki , mPackSigni , mPackAuthi , mVoucheri)
activate mORKx

note over mORKx
    hmac(mPacki,mVoucheri) == mPackAuthi ?
    userId ; AuthPRISMi ; CMKAuthi ; CMKi = ECDec(mPacki)
    hmac(mPacki, CMKAuthi) == mPackSigni ?
    Store(userId ; AuthPRISMi ; CMKAuthi ; CMKi)
end note 
mORKx- ->Consumer: conf
deactivate mORKx
Consumer->mORKx: TestRun
activate mORKx

mORKx- ->Consumer: TestReply
deactivate mORKx
Consumer->vORKx: TestRun
activate vORKx

vORKx- ->Consumer: TestReply
deactivate vORKx
Consumer->Vendor: Commit
activate Vendor

Vendor->vORKx: Commit
activate vORKx

Consumer->mORKx: Commit
activate mORKx

mORKx- ->Consumer: Ack
deactivate mORKx
vORKx- ->Vendor: Ack
deactivate vORKx
Vendor- ->Consumer: Ack
deactivate Vendor

@enduml

PlantUML version 1.2020.10(Sun May 17 19:35:57 AEST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.8+10-post-Ubuntu-0ubuntu118.04.1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>